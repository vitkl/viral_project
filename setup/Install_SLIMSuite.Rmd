---
title: "Install SLIMSuite"
author: "Vitalii Kleshchevnikov"
date: "31/08/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(downloader)
library(R.utils)
```

## Install SLIMSuite on Mac

Details on how to install the slim and new versions of the software can be found here:   http://slimsuite.blogspot.co.uk/2013/08/availability-installation-and-setup.html  

```{r install}
url = "https://github.com/slimsuite/SLiMSuite/releases/download/v1.2.0/slimsuite.2016-09-12.tgz"
direct = "../../software/"
if(!dir.exists(direct)) dir.create(direct)
filename = "slimsuite.2016-09-12.tgz"
filepath = paste0(direct, filename)
if(!file.exists(filepath)) download(url, filepath)
untar(filepath, exdir = direct,list=F)
```

## SLIMSuite manuals

All manuals can be found here: https://github.com/slimsuite/SLiMSuite/tree/master/docs/manuals   
  
SLiMFinder manual: https://github.com/slimsuite/SLiMSuite/blob/master/docs/manuals/SLiMFinder%20Manual.pdf  
CompariMotif Manual: https://github.com/slimsuite/SLiMSuite/blob/master/docs/manuals/CompariMotif%20Manual.pdf  

# Install BLAST+

```{r blast}
blast_path = paste0(direct, "ncbi-blast-2.6.0+-x64-macosx.tar.gz")
if(!file.exists(blast_path)) download("ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.6.0+-x64-macosx.tar.gz",
         blast_path)
untar(blast_path, exdir = direct, list=F)
system("mv ../../software/ncbi-blast-2.6.0+ ../../software/ncbi_blast_2.6.0")

```

# Install IUPRED

Go to : http://iupred.enzim.hu/
Unzip the emailed file.
Compile IUPRED

# Install SLIMSuite on linux cluster

```{r install}
setwd("/hps/nobackup/research/petsalaki/users/vitalii/vitalii/viral_project/setup/")
url = "https://github.com/slimsuite/SLiMSuite/releases/download/v1.2.0/slimsuite.2016-09-12.tgz"
direct = "../../software/cluster/"
if(!dir.exists(direct)) dir.create(direct)
filename = "slimsuite.2016-09-12.tgz"
filepath = paste0(direct, filename)
if(!file.exists(filepath)) download(url, filepath)
untar(filepath, exdir = direct,list=F)
```

# Install BLAST+ on linux cluster

```{r blast}
setwd("/hps/nobackup/research/petsalaki/users/vitalii/vitalii/viral_project/setup/")
blast_path = paste0(direct, "ncbi-blast-2.6.0+-x64-linux.tar.gz")
if(!file.exists(blast_path)) download("ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.6.0+-x64-linux.tar.gz",
         blast_path)
untar(blast_path, exdir = direct, list=F)
system("mv ../../software/cluster/ncbi-blast-2.6.0+ ../../software/cluster/ncbi_blast_2.6.0")

```

# Install IUPRED on linux cluster

Go to : http://iupred.enzim.hu/
Unzip the emailed file.
Compile IUPRED

# test on cluster

```{r cluster_test}
setwd("/hps/nobackup/research/petsalaki/users/vitalii/vitalii/viral_project/setup/")
```

```{bash cluster_test}
cd /hps/nobackup/research/petsalaki/users/vitalii/vitalii/viral_project/
software_PATH="../software/cluster/"
SLIM_PATH=$software_PATH"slimsuite/tools/"
QSLIMFinder=$SLIM_PATH"qslimfinder.py"
BLAST_PATH=$software_PATH"ncbi_blast_2.6.0/bin/"

# To set an environment variable everytime, use the export command in the .bashrc file (or the appropriate initialization file for your shell).
export IUPred_PATH="../software/cluster/iupred/iupred"

res_dir="./SLIMFinder/QSLIMFinder/"
res_path=$res_dir"res.csv"
echo $QSLIMFinder
echo $IUPred_PATH
#python $QSLIMFinder 

#QSLIMFinder
while IFS=$'\t' read -r data query;
do
python $QSLIMFinder blast+path=$BLAST_PATH iupath=$IUPred_PATH resdir=$res_dir resfile=$res_path seqin=$data query=$query dismask=T consmask=T cloudfix=F probcut=0.5
done < ./SLIMFinder/filelist.txt

# QSLIMFinder as a bjob
res_dir="./SLIMFinder/QSLIMFinder/bjob4"
res_path=$res_dir"bjob_res4.csv"
while IFS=$'\t' read -r data query;
do
bsub -n 1 -q research-rh7 -M 100 -R "rusage[mem=100]" python $QSLIMFinder blast+path=$BLAST_PATH iupath="../software/cluster/iupred/iupred" resdir=$res_dir resfile=$res_path seqin=$data query=$query dismask=T consmask=T cloudfix=F probcut=0.5
done < ./SLIMFinder/filelist.txt
```
